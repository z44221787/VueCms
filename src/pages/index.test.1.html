<!DOCTYPE html>

<html>

<head>
    <title></title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
        integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <!-- 模版所需要js文件 -->
    <script type="text/javascript" src="/node_modules/avalon2/dist/avalon.js"></script>
    <script type="text/javascript" src="/src/lib/utils/uuid.js"></script>
    <script type="text/javascript" src="/src/lib/utils/promiseM.js"></script>
    <script type="text/javascript" src="/src/lib/utils/Event.js"></script>
    <script type="text/javascript" src="/src/lib/linq.js_ver2.2.0.2/linq.js"></script>
    <script type="text/javascript" src="/src/lib/component/ms-content.js"></script>

    <!-- 引入分页组件 -->
    <script type="text/javascript" src="/src/lib/component/pagerComponent/pageComponent.js"></script>
    <link href="/src/lib/component/pagerComponent/pageComponent.css" rel="stylesheet"></link>

    <style>
        /* 解决页面初始化加载出现花括号 */
        .ms-controller {
            display: none;
        }
    </style>
</head>

<body>
    <ul class="new02 XxKul">
        <xmp ms-widget="{is:'ms-content',load:['loadData'],events:['changeLimitNum']}">
            <span zr-if="data.num===undefined">故意延迟加载数据了3秒，请稍等.....</span>
            <select zr-on-change="@trigger('EmitchangePage',$event)" zr-duplex-number='@data.num | change'>
                <option>1</option>
                <option>2</option>
                <option>3</option>
                <option>4</option>
                <option>5</option>
            </select>
            <ul>
                <li zr-for='el in @data.array | limitBy(@data.num)'>{{el}}</li>
            </ul>
            <ul>
                <li zr-for='el in @data.object | limitBy(@data.num)'>{{el}}</li>
            </ul>

            <hr>
            <h1>分页组件(由父级提供基础数据)</h1>
            <template zr-widget="{is:'ms-pager',totalPage:@data.totalPage,showPage:@data.showPage,pages:@data.pages,events:['changePage']}"></template>
        </xmp>


        <input id='num' type="text" value="1">
        <button type="button" onclick="change()">手动改变筛选几条</button>
    </ul>
</body>

<script>
    function loadData(e) {
        window.setTimeout(function () {
            var data = {
                num: 3,
                array: [1, 2, 3, 4, 5, 6],
                object: {
                    a: 1,
                    b: 2,
                    c: 3,
                    d: 4,
                    e: 5
                }
            };
            
            // 提前利用父级数据预加载子组件分页控件数据
            data.totalPage = 12;
            data.showPage = 3;
            data.pages = [1,2,3],

            e.resolve(data);
        }, 3000);
    }

    // 注册消息事件
    function changePage(e,ee){
        ee.currentPage=Number(jQuery(e.target).val());
    }

    // 在事件中发布触发事件
    function EmitchangePage(pageSize){
        zEvent.emit('changePage',pageSize);
    }


    
    // 注册消息事件
    function changeLimitNum(e, ee) {
        ee.data.num = Number(e);
    }

    // 在事件中发布触发事件    
    function change() {
        zEvent.emit('changeLimitNum', $("#num").val());
    }

</script>

</html>